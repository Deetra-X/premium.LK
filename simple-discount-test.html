<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Discount Test Form</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .form-group { margin: 15px 0; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select { padding: 10px; width: 300px; font-size: 16px; }
        button { padding: 15px 30px; font-size: 16px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin-top: 20px; padding: 15px; background: #333; border-radius: 5px; }
        .debug { background: #2a2a2a; padding: 10px; margin: 10px 0; border-radius: 5px; font-family: monospace; }
    </style>
</head>
<body>
    <h1>üîß Simple Discount Rate Test Form</h1>
    <p>This form bypasses all complex frontend logic and sends data directly to your backend.</p>

    <form id="discountTestForm">
        <div class="form-group">
            <label>Customer Name:</label>
            <input type="text" id="customerName" value="Simple Test Customer" required>
        </div>

        <div class="form-group">
            <label>Customer Email:</label>
            <input type="email" id="customerEmail" value="simple@test.com" required>
        </div>

        <div class="form-group">
            <label>Customer Phone:</label>
            <input type="text" id="customerPhone" value="+94771234567" required>
        </div>

        <div class="form-group">
            <label>Customer Type:</label>
            <select id="customerType">
                <option value="standard">Standard</option>
                <option value="reseller" selected>Reseller</option>
            </select>
        </div>

        <div class="form-group">
            <label>Discount Rate (%):</label>
            <input type="number" id="discountRate" value="40" min="0" max="100" required>
        </div>

        <div class="form-group">
            <label>Product Name:</label>
            <input type="text" id="productName" value="Test Product" required>
        </div>

        <div class="form-group">
            <label>Product Price:</label>
            <input type="number" id="productPrice" value="100" min="0" step="0.01" required>
        </div>

        <div class="form-group">
            <label>Quantity:</label>
            <input type="number" id="quantity" value="1" min="1" required>
        </div>

        <button type="submit">üöÄ Create Sale with Discount</button>
    </form>

    <div id="result" class="result" style="display: none;"></div>

    <script>
        document.getElementById('discountTestForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = '<p>üîÑ Processing...</p>';

            // Get form values
            const formData = {
                customerName: document.getElementById('customerName').value,
                customerEmail: document.getElementById('customerEmail').value,
                customerPhone: document.getElementById('customerPhone').value,
                customerType: document.getElementById('customerType').value,
                discountRate: parseFloat(document.getElementById('discountRate').value),
                productName: document.getElementById('productName').value,
                productPrice: parseFloat(document.getElementById('productPrice').value),
                quantity: parseInt(document.getElementById('quantity').value)
            };

            const totalAmount = formData.productPrice * formData.quantity;
            
            console.log('üîç Form data collected:', formData);
            console.log('üíØ Discount rate from form:', formData.discountRate);

            // Prepare request exactly like your frontend should send
            const requestData = {
                customer_name: formData.customerName,
                customer_email: formData.customerEmail,
                customer_phone: formData.customerPhone,
                customer_type: formData.customerType,
                items: [{
                    product_id: "simple-test-product",
                    product_name: formData.productName,
                    price: formData.productPrice,
                    quantity: formData.quantity,
                    email: formData.customerEmail,
                    total: totalAmount
                }],
                total_amount: totalAmount,
                discount_rate: formData.discountRate, // This is the key field!
                payment_method: "cash",
                status: "completed"
            };

            resultDiv.innerHTML += '<div class="debug"><strong>üì§ Request Data:</strong><br>' + JSON.stringify(requestData, null, 2) + '</div>';

            try {
                const response = await fetch('http://localhost:3001/api/sales', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                if (response.ok) {
                    const result = await response.json();
                    console.log('‚úÖ Sale created successfully:', result);
                    
                    resultDiv.innerHTML += '<div style="color: #4CAF50;"><strong>‚úÖ SUCCESS!</strong></div>';
                    resultDiv.innerHTML += '<div class="debug"><strong>üì• Response:</strong><br>' + JSON.stringify(result, null, 2) + '</div>';
                    
                    if (result.data) {
                        resultDiv.innerHTML += '<div class="debug">';
                        resultDiv.innerHTML += '<strong>üîç Key Values:</strong><br>';
                        resultDiv.innerHTML += 'Order Number: ' + result.data.order_number + '<br>';
                        resultDiv.innerHTML += 'Discount Rate: ' + result.data.discountRate + '%<br>';
                        resultDiv.innerHTML += 'Total Amount: $' + result.data.total_amount + '<br>';
                        resultDiv.innerHTML += '</div>';
                    }
                } else {
                    const errorText = await response.text();
                    console.error('‚ùå Failed to create sale:', response.status, errorText);
                    resultDiv.innerHTML += '<div style="color: #f44336;"><strong>‚ùå FAILED:</strong> ' + response.status + '</div>';
                    resultDiv.innerHTML += '<div class="debug">' + errorText + '</div>';
                }
            } catch (error) {
                console.error('‚ùå Network error:', error);
                resultDiv.innerHTML += '<div style="color: #f44336;"><strong>‚ùå ERROR:</strong> ' + error.message + '</div>';
            }
        });

        // Real-time discount calculation display
        function updateCalculation() {
            const price = parseFloat(document.getElementById('productPrice').value) || 0;
            const quantity = parseInt(document.getElementById('quantity').value) || 1;
            const discountRate = parseFloat(document.getElementById('discountRate').value) || 0;
            
            const subtotal = price * quantity;
            const discountAmount = (subtotal * discountRate) / 100;
            const total = subtotal - discountAmount;
            
            console.log('üí∞ Live calculation:', { subtotal, discountRate, discountAmount, total });
        }

        document.getElementById('productPrice').addEventListener('input', updateCalculation);
        document.getElementById('quantity').addEventListener('input', updateCalculation);
        document.getElementById('discountRate').addEventListener('input', updateCalculation);
    </script>
</body>
</html>
